!function e(r,n,t){function i(f,a){if(!n[f]){if(!r[f]){var c="function"==typeof require&&require;if(!a&&c)return c(f,!0);if(o)return o(f,!0);throw new Error("Cannot find module '"+f+"'")}var u=n[f]={exports:{}};r[f][0].call(u.exports,function(e){var n=r[f][1][e];return i(n||e)},u,u.exports,e,r,n,t)}return n[f].exports}for(var o="function"==typeof require&&require,f=0;f<t.length;f++)i(t[f]);return i}({1:[function(e,r,n){(function(){var e;e=function(){var e,r,n,t,i,o;function f(){}return 40,10,14,255,9,9,9,512,n=1<<(e=9-(r=2)-1)-2,65535,65535,r=2,24,16,o=function(e){var r,n;for(n=0,r=0;!((r=e>>>24)||(n+=8,255&(r=e>>>16))||(n+=8,255&(r=e>>>8))||(n+=8,255&(r=e)));)return n+=8;return 240&r?r>>>=4:n+=4,8&r?n:4&r?n+1:2&r?n+2:1&r?n+3:n+4},t=function(e,r,n){var t,i,f,a,c;return i=e.bitPosition,a=e.peek(32-i)<<i,(t=o(~a))>=9?(e.advance(25),f=(a<<=9)>>>16):(e.advance(t+n),f=t*r+(c=(a<<=t+1)>>>32-n)-1,c<2?f-=c-1:e.advance(1)),f},i=function(e,r,n,t){var i,f,a,c;return i=e.bitPosition,a=e.peek(32-i)<<i,(f=o(~a))>=9?(e.advance(9),e.read(t)):(e.advance(f+1),1!==n&&(a<<=f+1,f*=r,c=a>>>32-n,e.advance(n-1),c>1&&(f+=c-1,e.advance(1))),f)},f.ag_params=function(e,r,n,t,i,o){return{mb:e,mb0:e,pb:r,kb:n,wb:(1<<n)-1,qb:512-r,fw:t,sw:i,maxrun:o}},f.dyn_decomp=function(f,a,c,u,s){var d,h,p,l,w,m,b,v,y,g,x,_,k;for(g=f.pb,l=f.kb,_=f.wb,m=f.mb0,k=0,d=0;d<u;)if(w=m>>>9,p=Math.min(31-o(w+3),l),b=1|-(1&(y=(v=i(a,w=(1<<p)-1,p,s))+k)),c[d++]=(y+1>>>1)*b,m=g*(v+k)+m-(g*m>>9),v>65535&&(m=65535),k=0,m<<r<512&&d<u){if(k=1,p=o(m)-24+(m+n>>e),!(d+(v=t(a,(1<<p)-1&_,p))<=u))return!1;for(h=0,x=v;h<x;h+=1)c[d++]=0;v>=65535&&(k=0),m=0}return!0},f}(),r.exports=e}).call(this)},{}],2:[function(e,r,n){(function(n){(function(){var t,i,o,f,a,c={}.hasOwnProperty;i="undefined"!=typeof window?window.AV:void 0!==n?n.AV:null,o=e("./ag_dec"),f=e("./dp_dec"),a=e("./matrix_dec"),t=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return function(e,r){for(var n in r)c.call(r,n)&&(e[n]=r[n]);function t(){this.constructor=e}t.prototype=r.prototype,e.prototype=new t,e.__super__=r.prototype}(r,i.Decoder),i.Decoder.register("alac",r),0,1,2,3,4,5,6,7,r.prototype.setCookie=function(e){var r,n,t;return"frma"===(n=i.Stream.fromBuffer(e)).peekString(4,4)&&n.advance(12),"alac"===n.peekString(4,4)&&n.advance(12),this.config={frameLength:n.readUInt32(),compatibleVersion:n.readUInt8(),bitDepth:n.readUInt8(),pb:n.readUInt8(),mb:n.readUInt8(),kb:n.readUInt8(),numChannels:n.readUInt8(),maxRun:n.readUInt16(),maxFrameBytes:n.readUInt32(),avgBitRate:n.readUInt32(),sampleRate:n.readUInt32()},(r=this.format).bitsPerChannel||(r.bitsPerChannel=this.config.bitDepth),this.mixBuffers=[new Int32Array(this.config.frameLength),new Int32Array(this.config.frameLength)],t=new ArrayBuffer(4*this.config.frameLength),this.predictor=new Int32Array(t),this.shiftBuffer=new Int16Array(t)},r.prototype.readChunk=function(e){var r,n,t,i,c,u,s,d,h,p,l,w,m,b,v,y,g,x,_,k,I,U,B,A,E,C,D,q,L,P,R,S,V,O,F,M,T,j,z,G,H,J,K,N,Q,W,X,Y,Z;if(this.stream.available(4)){for(e=this.bitstream,N=this.config.frameLength,C=this.config.numChannels,c=0,L=new ArrayBuffer(N*C*this.config.bitDepth/8),l=!1;!l;){switch(Y=e.read(3)){case 0:case 3:case 1:if(c+(u=1===Y?2:1)>C)throw new Error("Too many channels!");if(e.read(4),0!==e.read(12))throw new Error("Unused part of header does not contain 0, it should");if(S=e.read(1),n=e.read(2),w=e.read(1),3===n)throw new Error("Bytes are shifted by 3, they shouldn't be");if(S&&(N=e.read(32)),0===w){for(Q=8*n,i=this.config.bitDepth-Q+u-1,I=e.read(8),U=e.read(8),B=[],p=[],O=[],E=[],s=[],t=v=0,M=u;v<M;t=v+=1)for(B[t]=e.read(4),p[t]=e.read(4),O[t]=e.read(3),E[t]=e.read(5),X=s[t]=new Int16Array(32),m=g=0,T=E[t];g<T;m=g+=1)X[m]=e.read(16);for(n&&(W=e.copy(),e.advance(Q*u*N)),k=(j=this.config).mb,V=j.pb,y=j.kb,_=j.maxRun,t=x=0,z=u;x<z;t=x+=1){if(R=o.ag_params(k,V*O[t]/4,y,N,N,_),!o.dyn_decomp(R,e,this.predictor,N,i))throw new Error("Error in Aglib.dyn_decomp");0===B[t]?f.unpc_block(this.predictor,this.mixBuffers[t],N,s[t],E[t],i,p[t]):(f.unpc_block(this.predictor,this.predictor,N,null,31,i,0),f.unpc_block(this.predictor,this.mixBuffers[t],N,s[t],E[t],i,p[t]))}}else{for(Q=32-(i=this.config.bitDepth),m=A=0,G=N;A<G;m=A+=1)for(t=D=0,H=u;D<H;t=D+=1)Z=e.read(i)<<Q>>Q,this.mixBuffers[t][m]=Z;I=U=0,n=0}if(n)for(Q=8*n,m=P=0,J=N*u;P<J;m=P+=1)this.shiftBuffer[m]=W.read(Q);switch(this.config.bitDepth){case 16:if(q=new Int16Array(L,c),2===u)a.unmix16(this.mixBuffers[0],this.mixBuffers[1],q,C,N,I,U);else for(b=0,r=this.mixBuffers[0],m=F=0,K=N;F<K;m=F+=1)q[b]=r[m],b+=C;break;default:throw new Error("Only supports 16-bit samples right now")}c+=u;break;case 2:case 5:throw new Error("Unsupported element: "+Y);case 4:if(e.read(4),h=e.read(1),255===(d=e.read(8))&&(d+=e.read(8)),h&&e.align(),e.advance(8*d),!(e.pos<e.length))throw new Error("buffer overrun");break;case 6:if(15===(d=e.read(4))&&(d+=e.read(8)-1),e.advance(8*d),!(e.pos<e.length))throw new Error("buffer overrun");break;case 7:e.align(),l=!0;break;default:throw new Error("Unknown element: "+Y)}if(c>C)throw new Error("Channel index too large.")}return new Int16Array(L)}},r}(),r.exports=t}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ag_dec":1,"./dp_dec":3,"./matrix_dec":4}],3:[function(e,r,n){(function(){var e;e=function(){var e;function r(){}return e=function(e,r,n,t,i){var o,f;return o=new Uint8Array(e,r,i),f=new Uint8Array(n,t,i),o.set(f),e},r.unpc_block=function(r,n,t,i,o,f,a){var c,u,s,d,h,p,l,w,m,b,v,y,g,x,_,k,I,U,B,A,E,C,D,q,L,P,R,S,V,O,F,M,T,j,z,G,H,J,K,N,Q,W,X,Y;if(I=32-f,E=1<<a-1,n[0]=r[0],0===o)return e(n,0,r,0,4*t);if(31!==o){for(C=L=1,z=o;L<=z;C=L+=1)B=r[C]+n[C-1],n[C]=B<<I>>I;if(P=o+1,4===o){for(c=i[0],u=i[1],s=i[2],d=i[3],D=R=P,G=t;R<G;D=R+=1)if(X=E-c*(m=(Y=n[D-P])-n[V=D-1])-u*(b=Y-n[V-1])-s*(v=Y-n[V-2])-d*(y=Y-n[V-3])>>a,Q=-(B=A=r[D])>>>31|B>>31,B+=Y+X,n[D]=B<<I>>I,Q>0){if(d-=W=-y>>>31|y>>31,(A-=1*(W*y>>a))<=0)continue;if(s-=W=-v>>>31|v>>31,(A-=2*(W*v>>a))<=0)continue;if(u-=W=-b>>>31|b>>31,(A-=3*(W*b>>a))<=0)continue;c-=-m>>>31|m>>31}else if(Q<0){if(d-=W=-(-y>>>31|y>>31),(A-=1*(W*y>>a))>=0)continue;if(s-=W=-(-v>>>31|v>>31),(A-=2*(W*v>>a))>=0)continue;if(u-=W=-(-b>>>31|b>>31),(A-=3*(W*b>>a))>=0)continue;c+=-m>>>31|m>>31}i[0]=c,i[1]=u,i[2]=s,i[3]=d}else if(8===o){for(c=i[0],u=i[1],s=i[2],d=i[3],h=i[4],p=i[5],l=i[6],w=i[7],D=S=P,H=t;S<H;D=S+=1)if(X=E-c*(m=(Y=n[D-P])-n[V=D-1])-u*(b=Y-n[V-1])-s*(v=Y-n[V-2])-d*(y=Y-n[V-3])-h*(g=Y-n[V-4])-p*(x=Y-n[V-5])-l*(_=Y-n[V-6])-w*(k=Y-n[V-7])>>a,Q=-(B=A=r[D])>>>31|B>>31,B+=Y+X,n[D]=B<<I>>I,Q>0){if(w-=W=-k>>>31|k>>31,(A-=1*(W*k>>a))<=0)continue;if(l-=W=-_>>>31|_>>31,(A-=2*(W*_>>a))<=0)continue;if(p-=W=-x>>>31|x>>31,(A-=3*(W*x>>a))<=0)continue;if(h-=W=-g>>>31|g>>31,(A-=4*(W*g>>a))<=0)continue;if(d-=W=-y>>>31|y>>31,(A-=5*(W*y>>a))<=0)continue;if(s-=W=-v>>>31|v>>31,(A-=6*(W*v>>a))<=0)continue;if(u-=W=-b>>>31|b>>31,(A-=7*(W*b>>a))<=0)continue;c-=-m>>>31|m>>31}else if(Q<0){if(w-=W=-(-k>>>31|k>>31),(A-=1*(W*k>>a))>=0)continue;if(l-=W=-(-_>>>31|_>>31),(A-=2*(W*_>>a))>=0)continue;if(p-=W=-(-x>>>31|x>>31),(A-=3*(W*x>>a))>=0)continue;if(h-=W=-(-g>>>31|g>>31),(A-=4*(W*g>>a))>=0)continue;if(d-=W=-(-y>>>31|y>>31),(A-=5*(W*y>>a))>=0)continue;if(s-=W=-(-v>>>31|v>>31),(A-=6*(W*v>>a))>=0)continue;if(u-=W=-(-b>>>31|b>>31),(A-=7*(W*b>>a))>=0)continue;c+=-m>>>31|m>>31}i[0]=c,i[1]=u,i[2]=s,i[3]=d,i[4]=h,i[5]=p,i[6]=l,i[7]=w}else for(C=O=P,J=t;O<J;C=O+=1){for(X=0,Y=n[C-P],V=C-1,D=M=0,K=o;M<K;D=M+=1)X+=i[D]*(n[V-D]-Y);if(Q=-(B=A=r[C])>>>31|B>>31,B+=Y+(X+E>>a),n[C]=B<<I>>I,Q>0)for(D=T=o-1;T>=0&&(W=-(U=Y-n[V-D])>>>31|U>>31,i[D]-=W,!((A-=(o-D)*(W*U>>a))<=0));D=T+=-1);else if(Q<0)for(D=N=o-1;N>=0&&(W=-(U=Y-n[V-D])>>>31|U>>31,i[D]+=W,!((A-=(o-D)*(-W*U>>a))>=0));D=N+=-1);}}else for(F=n[0],C=q=1,j=t;q<j;C=q+=1)F=(B=r[C]+F)<<I>>I,n[C]=F},r}(),r.exports=e}).call(this)},{}],4:[function(e,r,n){(function(){var e;e=function(){function e(){}return e.unmix16=function(e,r,n,t,i,o,f){var a,c,u,s,d,h;if(0===f)for(a=c=0,d=i;c<d;a=c+=1)n[a*t+0]=e[a],n[a*t+1]=r[a];else for(a=u=0,h=i;u<h;a=u+=1)s=e[a]+r[a]-(f*r[a]>>o),n[a*t+0]=s,n[a*t+1]=s-r[a]},e}(),r.exports=e}).call(this)},{}]},{},[2]);
