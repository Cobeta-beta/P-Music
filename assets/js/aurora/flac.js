!function e(r,t,i){function a(n,s){if(!t[n]){if(!r[n]){var d="function"==typeof require&&require;if(!s&&d)return d(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var f=t[n]={exports:{}};r[n][0].call(f.exports,function(e){var t=r[n][1][e];return a(t||e)},f,f.exports,e,r,t,i)}return t[n].exports}for(var o="function"==typeof require&&require,n=0;n<i.length;n++)a(i[n]);return a}({1:[function(e,r,t){t.FLACDemuxer=e("./src/demuxer"),t.FLACDecoder=e("./src/decoder"),e("./src/ogg")},{"./src/decoder":2,"./src/demuxer":3,"./src/ogg":4}],2:[function(e,r,t){(function(e){var t="undefined"!=typeof window?window.AV:void 0!==e?e.AV:null,i=t.Decoder.extend(function(){t.Decoder.register("flac",this),this.prototype.setCookie=function(e){this.cookie=e,this.decoded=[];for(var r=0;r<this.format.channelsPerFrame;r++)this.decoded[r]=new Int32Array(e.maxBlockSize);this.lpc_total=new Int32Array(2)};const e=new Int16Array([0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768]),r=new Int32Array([0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0]),i=new Int8Array([0,8,12,0,16,20,24,0]);this.prototype.readChunk=function(){var t=this.bitstream;if(t.available(32)){if(32764!=(32767&t.read(15)))throw new Error("Invalid sync code");t.read(1);var a,o=t.read(4),n=t.read(4),s=t.read(4),d=t.read(3);if(t.advance(1),this.chMode=s,s<8)a=s+1,this.chMode=0;else{if(!(s<=10))throw new Error("Invalid channel mode");a=2}if(a!==this.format.channelsPerFrame)throw new Error("Switching channel layout mid-stream not supported.");if(3===d||7===d)throw new Error("Invalid sample size code");if(this.bps=i[d],this.bps!==this.format.bitsPerChannel)throw new Error("Switching bits per sample mid-stream not supported.");for(var f=0;1===t.read(1);)f++;for(var h=t.read(7-f);f>1;f--)t.advance(2),h=h<<6|t.read(6);if(0===o)throw new Error("Reserved blocksize code");if(this.blockSize=6===o?t.read(8)+1:7===o?t.read(16)+1:e[o],n<12)r[n];else if(12===n)1e3*t.read(8);else if(13===n)t.read(16);else{if(14!==n)throw new Error("Invalid sample rate code");10*t.read(16)}t.advance(8);for(var c=0;c<a;c++)this.decodeSubframe(c);t.align(),t.advance(16);var l=this.bps>16,u=new ArrayBuffer(this.blockSize*a*(l?4:2)),p=l?new Int32Array(u):new Int16Array(u),m=this.blockSize,v=this.decoded,w=0;switch(this.chMode){case 0:for(var b=0;b<m;b++)for(c=0;c<a;c++)p[w++]=v[c][b];break;case 8:for(c=0;c<m;c++){var I=v[0][c],y=v[1][c];p[w++]=I,p[w++]=I-y}break;case 9:for(c=0;c<m;c++){I=v[0][c],y=v[1][c];p[w++]=I+y,p[w++]=y}break;case 10:for(c=0;c<m;c++){I=v[0][c];I-=(y=v[1][c])>>1,p[w++]=I+y,p[w++]=I}}return p}},this.prototype.decodeSubframe=function(e){var r=0,t=this.bitstream,i=this.blockSize,a=this.decoded;if(this.curr_bps=this.bps,0===e?9===this.chMode&&this.curr_bps++:8!==this.chMode&&10!==this.chMode||this.curr_bps++,t.read(1))throw new Error("Invalid subframe padding");var o=t.read(6);if(t.read(1)){for(r=1;!t.read(1);)r++;this.curr_bps-=r}if(this.curr_bps>32)throw new Error("decorrelated bit depth > 32 ("+this.curr_bps+")");if(0===o)for(var n=t.read(this.curr_bps,!0),s=0;s<i;s++)a[e][s]=n;else if(1===o){var d=this.curr_bps;for(s=0;s<i;s++)a[e][s]=t.read(d,!0)}else if(o>=8&&o<=12)this.decode_subframe_fixed(e,-9&o);else{if(!(o>=32))throw new Error("Invalid coding type");this.decode_subframe_lpc(e,1+(-33&o))}if(r)for(s=0;s<i;s++)a[e][s]<<=r},this.prototype.decode_subframe_fixed=function(e,r){for(var t=this.decoded[e],i=this.bitstream,a=this.curr_bps,o=0;o<r;o++)t[o]=i.read(a,!0);this.decode_residuals(e,r);var n=0,s=0,d=0,f=0;switch(r>0&&(n=t[r-1]),r>1&&(s=n-t[r-2]),r>2&&(d=s-t[r-2]+t[r-3]),r>3&&(f=d-t[r-2]+2*t[r-3]-t[r-4]),r){case 0:break;case 1:case 2:case 3:case 4:var h=new Int32Array([n,s,d,f]),c=this.blockSize;for(o=r;o<c;o++){h[r-1]+=t[o];for(var l=r-2;l>=0;l--)h[l]+=h[l+1];t[o]=h[0]}break;default:throw new Error("Invalid Predictor Order "+r)}},this.prototype.decode_subframe_lpc=function(e,r){for(var t=this.bitstream,i=this.decoded[e],a=this.curr_bps,n=this.blockSize,s=0;s<r;s++)i[s]=t.read(a,!0);var d=t.read(4)+1;if(16===d)throw new Error("Invalid coefficient precision");var f=t.read(5,!0);if(f<0)throw new Error("Negative qlevel, maybe buggy stream");var h=new Int32Array(32);for(s=0;s<r;s++)h[s]=t.read(d,!0);if(this.decode_residuals(e,r),this.bps<=16){for(s=r;s<n-1;s+=2){for(var c=i[s-r],l=0,u=0,p=0,m=r-1;m>0;m--)l+=(p=h[m])*c,u+=p*(c=i[s-m]);l+=(p=h[0])*c,u+=p*(c=i[s]+=l>>f),i[s+1]+=u>>f}if(s<n){var v=0;for(m=0;m<r;m++)v+=h[m]*i[s-m-1];i[s]+=v>>f}}else{var w=this.lpc_total;for(s=r;s<n;s++){for(w[0]=0,w[1]=0,m=0;m<r;m++)o(w,h[m],i[s-m-1]);i[s]+=w[0]>>>f|w[1]<<32-f}}};const a=Math.pow(2,32);function o(e,r,t){var i=r*t,o=i<0;o&&(i=-i);var n=i%a|0,s=i/a|0;o&&(n=1+~n,s=~s);var d=e[1]>>>16,f=65535&e[1],h=e[0]>>>16,c=0,l=0,u=0,p=0;u+=(p+=(65535&e[0])+(65535&n))>>>16,p&=65535,l+=(u+=h+(n>>>16))>>>16,u&=65535,c+=(l+=f+(65535&s))>>>16,l&=65535,c+=d+(s>>>16),c&=65535,e[0]=u<<16|p,e[1]=c<<16|l}this.prototype.decode_residuals=function(e,r){var t=this.bitstream,i=t.read(2);if(i>1)throw new Error("Illegal residual coding method "+i);var a=t.read(4),o=this.blockSize>>>a;if(r>o)throw new Error("Invalid predictor order "+r+" > "+o);for(var n=this.decoded[e],s=r,d=r,f=0;f<1<<a;f++){var h=t.read(0===i?4:5);if(h===(0===i?15:31))for(h=t.read(5);d<o;d++)n[s++]=t.read(h,!0);else for(;d<o;d++)n[s++]=this.golomb(h,32767,0);d=0}};this.prototype.golomb=function(e,r,t){var i=this.bitstream,a=i.bitPosition,o=i.peek(32-a)<<a,n=0,s=31-function(e){var r=0,t=0;for(;!((t=e>>>24)||(r+=8,255&(t=e>>>16))||(r+=8,255&(t=e>>>8))||(r+=8,255&(t=e)));)return r+=8;240&t?t>>>=4:r+=4;return 8&t?r:4&t?r+1:2&t?r+2:1&t?r+3:r+4}(1|o);if(s-e>=7&&32-s<r)o>>>=s-e,o+=30-s<<e,i.advance(32+e-s),n=o;else{for(var d=0;0===i.read(1);d++)o=i.peek(32-a)<<a;n=d<r-1?(o=e?i.read(e):0)+(d<<e):d===r-1?(o=i.read(t))+1:-1}return n>>1^-(1&n)}});r.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,r,t){(function(e){var t="undefined"!=typeof window?window.AV:void 0!==e?e.AV:null,i=t.Demuxer.extend(function(){t.Demuxer.register(this),this.probe=function(e){return"fLaC"===e.peekString(0,4)};this.prototype.readChunk=function(){var e=this.stream;if(!this.readHeader&&e.available(4)){if("fLaC"!==e.readString(4))return this.emit("error","Invalid FLAC file.");this.readHeader=!0}for(;e.available(1)&&!this.last;){if(!this.readBlockHeaders){var r=e.readUInt8();this.last=128==(128&r),this.type=127&r,this.size=e.readUInt24()}if(!this.foundStreamInfo&&0!==this.type)return this.emit("error","STREAMINFO must be the first block");if(!e.available(this.size))return;switch(this.type){case 0:if(this.foundStreamInfo)return this.emit("error","STREAMINFO can only occur once.");if(34!==this.size)return this.emit("error","STREAMINFO size is wrong.");this.foundStreamInfo=!0;var i=new t.Bitstream(e),a={minBlockSize:i.read(16),maxBlockSize:i.read(16),minFrameSize:i.read(24),maxFrameSize:i.read(24)};this.format={formatID:"flac",sampleRate:i.read(20),channelsPerFrame:i.read(3)+1,bitsPerChannel:i.read(5)+1},this.emit("format",this.format),this.emit("cookie",a);var o=i.read(36);this.emit("duration",o/this.format.sampleRate*1e3|0),e.advance(16),this.readBlockHeaders=!1;break;case 3:for(var n=0;n<this.size/18;n++)if(4294967295==e.peekUInt32(0)&&4294967295==e.peekUInt32(1))e.advance(18);else{e.readUInt32()>0&&this.emit("error","Seek points with sample number >UInt32 not supported");var s=e.readUInt32();e.readUInt32()>0&&this.emit("error","Seek points with stream offset >UInt32 not supported");var d=e.readUInt32();e.advance(2),this.addSeekPoint(d,s)}break;case 4:this.metadata||(this.metadata={});var f=e.readUInt32(!0);this.metadata.vendor=e.readString(f);for(var h=e.readUInt32(!0),c=0;c<h;c++){f=e.readUInt32(!0);var l=e.readString(f,"utf8"),u=l.indexOf("=");this.metadata[l.slice(0,u).toLowerCase()]=l.slice(u+1)}break;case 6:if(3!==e.readUInt32())e.advance(this.size-4);else{var p=e.readUInt32(),m=(e.readString(p),e.readUInt32()),v=(e.readString(m),e.readUInt32(),e.readUInt32(),e.readUInt32(),e.readUInt32(),h=e.readUInt32(),e.readBuffer(h));this.metadata||(this.metadata={}),this.metadata.coverArt=v}break;default:e.advance(this.size),this.readBlockHeaders=!1}this.last&&this.metadata&&this.emit("metadata",this.metadata)}for(;e.available(1)&&this.last;){var w=e.readSingleBuffer(e.remainingBytes());this.emit("data",w)}}});r.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,r,t){(function(e){var r="undefined"!=typeof window?window.AV:void 0!==e?e.AV:null;try{var t="undefined"!=typeof window?window.AV.OggDemuxer:void 0!==e?e.AV.OggDemuxer:null}catch(e){}t&&t.plugins.push({magic:"FLAC",init:function(){this.list=new r.BufferList,this.stream=new r.Stream(this.list)},readHeaders:function(e){var t=this.stream;if(this.list.append(new r.Buffer(e)),t.advance(5),1!=t.readUInt8())throw new Error("Unsupported FLAC version");if(t.advance(3),"fLaC"!=t.peekString(0,4))throw new Error("Not flac");if(this.flac=r.Demuxer.find(t.peekSingleBuffer(0,t.remainingBytes())),!this.flac)throw new Error("Flac demuxer not found");return this.flac.prototype.readChunk.call(this),!0},readPacket:function(e){this.list.append(new r.Buffer(e)),this.flac.prototype.readChunk.call(this)}})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);
